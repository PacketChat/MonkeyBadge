from machine import Pin, SoftI2C
import ssd1306
import framebuf

class DisplayHandler:
    """
    A class for controlling an OLED display using the SSD1306 driver. The goal
    here is to display six lines of text, tried seven, but that fell off the
    bottom of the screen at that size.
    """

    def __init__(self, width, height, sda_pin, scl_pin):
        """
        Initialize the SSD1306 driver for controlling an OLED display.

        Args:
            width (int): Width of the display in pixels.
            height (int): Height of the display in pixels.
            sda_pin (int): Pin number for the SDA (data) line of the I2C bus.
            scl_pin (int): Pin number for the SCL (clock) line of the I2C bus.
        """
        self.i2c = SoftI2C(sda=Pin(sda_pin), scl=Pin(scl_pin))
        self.display = ssd1306.SSD1306_I2C(width, height, self.i2c)

    def clear(self):
        """
        Clear the display by filling it with black pixels.
        """
        self.display.fill(0)
        self.display.show()
    def print_logo(self):
        # 'HCcircle', 60x60px
        b=[0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3f, 0xc0, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x07, 0xff, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0xff, 0xff, 0x80, 0x00, 0x00, 
        0x00, 0x00, 0x7f, 0xff, 0xff, 0xe0, 0x00, 0x00, 0x00, 0x01, 0xff, 0xff, 0xff, 0xf8, 0x00, 0x00, 
        0x00, 0x07, 0xff, 0xff, 0xff, 0xfe, 0x00, 0x00, 0x00, 0x0f, 0xff, 0x00, 0x0f, 0xff, 0x00, 0x00, 
        0x00, 0x1f, 0xf8, 0x00, 0x01, 0xff, 0x80, 0x00, 0x00, 0x3f, 0xe0, 0x00, 0x00, 0x7f, 0xc0, 0x00, 
        0x00, 0x7f, 0x80, 0x00, 0x00, 0x1f, 0xe0, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x0f, 0xf0, 0x00, 
        0x01, 0xfe, 0x00, 0x00, 0x1e, 0xe7, 0xf8, 0x00, 0x03, 0xfc, 0x00, 0x00, 0x1e, 0xe3, 0xfc, 0x00, 
        0x03, 0xf8, 0x00, 0x00, 0x1e, 0xe1, 0xfc, 0x00, 0x07, 0xf0, 0x00, 0x00, 0x1e, 0xe0, 0xfe, 0x00, 
        0x07, 0xe0, 0x00, 0x00, 0x1e, 0xe0, 0x7e, 0x00, 0x0f, 0xc0, 0x00, 0x00, 0x1e, 0xe0, 0x3f, 0x00, 
        0x0f, 0xc0, 0x00, 0x00, 0x1e, 0xe0, 0x3f, 0x00, 0x1f, 0x80, 0x00, 0x00, 0x1f, 0xe0, 0x1f, 0x80, 
        0x1f, 0x80, 0x00, 0x00, 0x1f, 0xe0, 0x1f, 0x80, 0x3f, 0x00, 0x00, 0x00, 0x1f, 0xe0, 0x0f, 0xc0, 
        0x3f, 0x00, 0x00, 0x00, 0x1f, 0xe0, 0x0f, 0xc0, 0x3f, 0x00, 0x00, 0x00, 0x1e, 0xe0, 0x0f, 0xc0, 
        0x3e, 0x00, 0xff, 0x80, 0x1e, 0xe0, 0x07, 0xc0, 0x3e, 0x01, 0xff, 0xe0, 0x1e, 0xe0, 0x07, 0xc0, 
        0x7e, 0x07, 0xff, 0xf8, 0x1e, 0xe0, 0x07, 0xe0, 0x7e, 0x0f, 0xff, 0xfc, 0x1e, 0xe0, 0x07, 0xe0, 
        0x7e, 0x1f, 0xff, 0xfe, 0x1e, 0xe0, 0x07, 0xe0, 0x7e, 0x3f, 0xc0, 0xff, 0x1e, 0xe0, 0x07, 0xe0, 
        0x7e, 0x1f, 0x1e, 0x3f, 0x9e, 0xe6, 0x07, 0xe0, 0x7e, 0x06, 0x3f, 0x1f, 0xc0, 0x0f, 0x07, 0xe0, 
        0x7e, 0x00, 0x3f, 0x0f, 0xe0, 0x1f, 0xc7, 0xe0, 0x7e, 0x00, 0x77, 0x07, 0xf8, 0x7f, 0x87, 0xe0, 
        0x3e, 0x00, 0x77, 0x83, 0xff, 0xff, 0x07, 0xc0, 0x3e, 0x00, 0x77, 0x81, 0xff, 0xfe, 0x07, 0xc0, 
        0x3f, 0x00, 0x77, 0x80, 0xff, 0xfc, 0x0f, 0xc0, 0x3f, 0x00, 0x77, 0x80, 0x3f, 0xf8, 0x0f, 0xc0, 
        0x3f, 0x00, 0x77, 0x80, 0x0f, 0xc0, 0x0f, 0xc0, 0x1f, 0x80, 0x70, 0x00, 0x00, 0x00, 0x1f, 0x80, 
        0x1f, 0x80, 0x70, 0x00, 0x00, 0x00, 0x1f, 0x80, 0x0f, 0xc0, 0x70, 0x00, 0x00, 0x00, 0x3f, 0x00, 
        0x0f, 0xc0, 0x77, 0x80, 0x00, 0x00, 0x3f, 0x00, 0x07, 0xe0, 0x77, 0x80, 0x00, 0x00, 0x7e, 0x00, 
        0x07, 0xf0, 0x77, 0x80, 0x00, 0x00, 0xfe, 0x00, 0x03, 0xf8, 0x77, 0x80, 0x00, 0x01, 0xfc, 0x00, 
        0x03, 0xf8, 0x7f, 0x00, 0x00, 0x01, 0xfc, 0x00, 0x01, 0xfe, 0x7f, 0x00, 0x00, 0x07, 0xf8, 0x00, 
        0x00, 0xff, 0x3f, 0x00, 0x00, 0x0f, 0xf0, 0x00, 0x00, 0x7f, 0x9c, 0x00, 0x00, 0x1f, 0xe0, 0x00, 
        0x00, 0x3f, 0xe0, 0x00, 0x00, 0x7f, 0xc0, 0x00, 0x00, 0x1f, 0xf8, 0x00, 0x01, 0xff, 0x80, 0x00, 
        0x00, 0x0f, 0xff, 0x00, 0x0f, 0xff, 0x00, 0x00, 0x00, 0x07, 0xff, 0xff, 0xff, 0xfe, 0x00, 0x00, 
        0x00, 0x01, 0xff, 0xff, 0xff, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x7f, 0xff, 0xff, 0xe0, 0x00, 0x00, 
        0x00, 0x00, 0x1f, 0xff, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 0x07, 0xff, 0xfe, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x3f, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
        
        fb = framebuf.FrameBuffer(bytearray(b), 60, 60, framebuf.MONO_HLSB)

        self.display.fill(0)
        self.display.blit(fb, 34, 2)
        self.display.show()

    def print_lines(self, lines):
        """
        Display text on the OLED screen.

        Args:
            list of strings, we only print the first 6 elements of the list.
        """
        self.clear()
        for i, line in enumerate(lines):
            self.display.text(line, 0, i * 11, 1)
        self.display.show()
